


Hi,

	We have queries on PCIe and Pictrl topic as below.
  
	1. Regarding pin control of "WiFi_BT_Power_On_GPIO" 
	
	In IDCEvo B2 hardware, 1.8V and 3.3V power siupply to WiFi/BT chip is made switchable using
 	Active-High MOS switch through a GPIO (GPP1_1) of SOC. Screenshot of schematic is attached 
	with this mail.
	
	As WiFi chip is current hungry device, so to reduce power consumption, we are making Power 
	to WiFi chip to disable in Suspend state.
	
	To facilitate this, we tried changing DTS having pinctrl states "default" and "sleep" using
	"pinctrl-names = "default", "sleep";".
	
	But when target was suspended, it was not invoking Pinctrl-stae - sleep. Then by doing code 
	walk-through, it was found that PCIe controller driver supports Pinctrl-State - "default" and
	"idle". 
	
	Code snippet: 
	--------------
	exynos_v920_pcie_probe() -> exynos_v920_pcie_pinconfig()
	{
        .........
        exynos_pcie->pcie_pinctrl = devm_pinctrl_get(pci->dev);

        exynos_pcie->pin_state[PCIE_PIN_DEFAULT] =
                pinctrl_lookup_state(exynos_pcie->pcie_pinctrl, "default");

        exynos_pcie->pin_state[PCIE_PIN_IDLE] =
                pinctrl_lookup_state(exynos_pcie->pcie_pinctrl, "idle");

        .......
	}
	
	Proposed DTS change: -
	
	&pinctrl_peric0 {
		....
		wifibt_power_enable_pin_active: wifibt_power_enable_pin_active {
			samsung,pins = "gpp1-1";
			samsung,pin-function = <EXYNOS_PIN_FUNC_OUTPUT>;
			samsung,pin-pud = <EXYNOS_PIN_PULL_UP>;
			samsung,pin-drv = <EXYNOS5420_PIN_DRV_LV1>;
			samsung,pin-val = <1>;
		};

		wifibt_power_enable_pin_sleep: wifibt_power_enable_pin_sleep {
			samsung,pins = "gpp1-1";
			samsung,pin-function = <EXYNOS_PIN_FUNC_OUTPUT>;
			samsung,pin-pud = <EXYNOS_PIN_PULL_DOWN>;
			samsung,pin-drv = <EXYNOS5420_PIN_DRV_LV1>;
			samsung,pin-val = <0>;
		};
	};
	
	&pcie_2 {
		status = "okay";
		use-msi = "true";
		use-bifurcation = "true";
		num-lanes = <1>;
		pinctrl-names = "default", "idle";
		pinctrl-0 = <&pcie_clkreq2 &pcie_perst2_out &wifi_reg_ch2 &wifibt_power_enable_pin_active>;
		pinctrl-1 = <&pcie_clkreq2 &pcie_perst2_out &wifi_reg_ch2 &wifibt_power_enable_pin_sleep>;
		gpio_wifi_reg_on = <&gpp1 5 GPIO_ACTIVE_HIGH>;
	};
	
	With above DTS change, Power-on-Gpio is going LOW as expected in suspend state. Complete analysis
	on this topic is attached as PDF file with this mail. 
	Is above DTS changes correct, please provide your valuable inputs.
	
	2. Regarding PCIe channel versus Pin assignment
	
	As per schematic following are the pins for WLAN1 except some control GPIOs.
	
	WLAN1_SOC_PCIE2L_L(0)_RX_P
	WLAN1_SOC_PCIE2L_L(0)_RX_N
	
	WLAN1_SOC_PCIE2L_L(0)_TX_N
	WLAN1_SOC_PCIE2L_L(0)_TX_P
	
	WLAN1_SOC_PCIE2L_REFCLK0_N
	WLAN1_SOC_PCIE2L_REFCLK0_P
	
	WLAN1_SOC_PCIE_CLKREQ(2)_Q
	
	As per .dtsi, above mentioned pins belong to PCIe channel-2 i.e. pcie@161C0000. We could not find in Exynosv920 TRM
	document that How PCIe pins are mapped to the PCIe channel. 
	So, could you to please let us know your inputs for our clarification.
	
	Thanks and regards,
	Mir 